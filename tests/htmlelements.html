<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=800">
	<title>HTML*ELement</title>
	<link rel="stylesheet" type="text/css" href="testindex.css">
	<script src="testglobals.js"></script>
	<script src="testgeneric.js"></script>
	<style>
		table {width: 90%; min-width: 600px; max-width: 780px}
		hr {color: var(--test15);}
		span.indent {
			display:inline-block;margin-left:10px;
		}
		.grey {color: grey;}
	</style>
</head>

<body>
	<table>
	<tr><td><h2>TorZillaPrint</h2></td></tr>
	<tr><td class="blurb"><a class="return" href="../index.html">return to TZP index</a></td></tr>
	</table>

	<table id="tb15">
		<col width="1%"><col width="99%">
		<thead><tr><th colspan="2">
			<div class="nav-title">HTML*Element
			<div class="nav-up"><span class="c perf" id="perf"></span></div>
			</div>
		</th></tr></thead>
		<tr><td colspan="2" class="intro">
			<span class="no_color"></span>
				<span class="btn15 btnfirst" onClick="run()">[ run ]</span>
				<input type="checkbox" id="optSort"> <span class="no_color">sort</span>
			</span>
		</td></tr>
		<tr><td colspan="2"><hr></td></tr>
		<tr><td colspan="2"></td></tr>
		<tr><td></td><td class="mono spaces" id="details"></td></tr>
	</table>
	<br>

<script>
'use strict';

s6 = s6.trim()
s15 = s15.trim()
sb = sb.trim()

let oData = {}
let aEverything = []
let is70 = ("function" === typeof Intl.RelativeTimeFormat
		&& "function" === typeof Intl.RelativeTimeFormat.prototype.formatToParts)
let is92 = ("function" === typeof Object.hasOwn)
let is111 = (HTMLElement.prototype.hasOwnProperty("translate"))

let htmlList = [
	/*
	0,
	//*/

	5,
	// changes since FF115 (at least on windows) or exhibit extension fuckery
	// property added unless prefixed with a minus sign
	'Element', // Element (not HTML+item+Element)
	'Button',
		// ^ (122/nightly) popoverTargetElement, popoverTargetAction
	'HTMLElement', // HTMLElement
		// ^ (117) oncancel
	'Frame',
		// ^ ext fuckery
	'IFrame',
		// ^ (121) loading
	'Input',
		// ^ (116) dirName
	'Media',
		// ^ (116) setSinkId, sinkId
		// (122/nightly) showPopover, hidePopover, togglePopover, popover, onbeforetoggle, -ondragexit
		// (122/nightly) -ondragexit
	'Object',
	 // ^ ext fuckery
	'Select',
		// ^ (122/nightly) showPicker
	'Template',
		// (122/nightly) shadowRootMode, shadowRootDelegatesFocus
	'TextArea',
		// ^ (116) dirName
	'Video',

	6,
	// changes since FF104 (but stable since FF111 - that is not in current ESR115 cycle)
		// last checked 122
	'Canvas', // last change 105 = cf7b9afc
	'Form', // last change 111 = bff84eef
	'Meta', // last change 106 = d32c1bc0
	'Source', // last change 108 = e74ef3df

	7, // stable since FF92
	'Body',
	'FrameSet',
	'Image',
	'Link',
	'Menu', // changed 85
	'Meter',
	'Output',
	'Param', // changed 85
	'Progress',
	'Script',
	'Slot', // new in 63, changed 66 92
	'Style',

	8, // stable since FF70
	'AllCollection', // changed 64
	'Document', // changed 57, 58, 60, 61, 68, 69, 70

	9, // stable since FF52
	'Anchor','Area','Audio','BR','Base','HTMLCollection','DList','Data','DataList','Details',
	'Dialog', // new 98 but not changed since
	'Directory','Div','Embed','FieldSet','Font','FormControlsCollection','HR','Head','Heading',
	'Html','Label','LI','Legend','Map',
	'Marquee', // new 65 but not changed since
	'Mod','OList','OptGroup','Option','OptionsCollection',
	'Paragraph','Picture','Pre','Quote','Span',
	'Table','TableCaption','TableCell','TableCol','TableRow',
	'TableSection','Time','Title','Track','UList','Unknown',

]

let groupInfo = {
	0: ["more", "0more", "hiddenm", "add MOAR stuff"],

	// elements section
	5: ["main", "5main", "hiddenu", "changes since FF115 | show extension tampering"],
	6: ["recent", "6recent", "hiddenv", "changes since FF104 (stable since FF111)"],
	7: ["stable92","7stable92", "hiddenx", "AFAICT FF92+"],
	8: ["stable70","8stable70","hiddeny", "AFAICT FF70+"],
	9: ["stable52","9stable52", "hiddenz", "AFAICT FF52+ or since items added"],
}

function tidyList() {
	let ignoreList = [
		'AllCollection','Document','FormControlsCollection','OptionsCollection'
	]
	let doNothing = ['Element','HTMLElement','HTMLCollection']
	let currentNo = 0, tList = []
	
	for (let i=0; i < htmlList.length; i++) {
		let value = htmlList[i]
		if ("string" === typeof value) {
			if (currentNo > 4) {
				if (!doNothing.includes(value)) {
					let suffix = ignoreList.includes(value) ? "" : "Element"
					value = 'HTML' + value + suffix
					htmlList[i] = value
				}
			}
			tList.push(value)
		} else {
			if (tList.length) {
				tList.sort()
				//console.log(currentNo, "'"+ tList.join("','") +"'")
			}
			tList = []
			currentNo = value
		}
	}
}
tidyList()

function run() {
	// e.g. https://developer.mozilla.org/en-US/docs/Web/API/HTMLAnchorElement

	oData = {}
	aEverything = []
	let t0 = performance.now()
	let optSort = dom.optSort.checked

	try {
		let display = [], toggle = "", group = "", groups = [], name = ""

		htmlList.forEach(function(k) {
			if ("number" == typeof k) {
				name = groupInfo[k][0]
				let byline = groupInfo[k][3]
				group = groupInfo[k][1]
				toggle = groupInfo[k][2]
				groups.push(group)
				oData[group] = {}
				display.push(
					"<br><hr>"
					+ "<span id='label"+ toggle +"' class='btnfirst btn0' onClick=\"togglerows('"+ toggle +"','expand')\">[ expand ]</span> "
					+ "<span id='"+ group +"'></span> "
					+ name.toUpperCase() +" <span class='grey'>... "+ byline +"</span><br><br>"
				)
			} else {
				if (window[k] !== undefined) {
					let data = window[k].prototype
					try {
						let array = Object.getOwnPropertyNames(data)
						let fake = array.slice(array.indexOf("constructor")+1) // tampered: after constructor
						if (optSort) {array.sort()}
						let tmpArray = []
						array.forEach(function(item) {
							tmpArray.push(item)
							aEverything.push(item)
						})
						oData[group][k] = tmpArray
						let hash = mini(tmpArray), countFake = ""
						// count + color each fake individually
						if (fake.length) {
							countFake = " "+ sb + "("+ fake.length +")"+ sc
							fake.forEach(function(item) {
								array[array.indexOf(item)] = sb + item + sc
							})
						}
						display.push(
							s15 + k.padStart(30) + sc + ": "+ hash + s15 +" ("+ oData[group][k].length +")"+ sc + countFake +"<br>"+
							"<span class='tog" + toggle +" hidden grey'>[<br>" + "<span class='indent'>" + array.join(", ") +"</span>" + "<br>]</span>"
						)
					} catch(e) {
						console.log(k, "not an array", e+"")
					}					
				} else {
					console.log(k, "is undefined")
					// doesn't exist
				}
			}
		})

		//* everything
		//console.log(aEverything) // 815 all : 749 (no constructors)
		aEverything = aEverything.filter(function(item, position) {return aEverything.indexOf(item) === position}) // deduped
		aEverything.sort() // order is artifical due to htmlList so lets remove that here
		aEverything = aEverything.filter(x => !["constructor"].includes(x)) // remove constructor
		//console.log("['"+ aEverything.join("','") +"']") // 447
		//*/

		// display
		let strAll = s15 +"ALL"+ sc +": "+ s6 + mini(oData) + sc
			+ " <span class='btn15 btnc' onclick='console.log(oData)'>[console]</span> "
			+ (optSort ? "sorted" : "unsorted") +" | unique values: "+ mini(aEverything)
			+" ["+ aEverything.length +"] "
		dom.details.innerHTML = strAll +"<br>"+ display.join("")

		// add sub hashes
		groups.forEach(function(g) {
			let hash = mini(oData[g])
			let notation = ""
			// notate
			if (isFF && !optSort) {
				let firstchar = g.slice(0,1)
				if (firstchar == "6" && is111) { notation = (hash == "b0cb1af2") ? green_tick : zNEW
				} else if (firstchar == "7" && is92) { notation = (hash == "4c9f8cea") ? green_tick : zNEW
				} else if (firstchar == "8" && is70) { notation = hash == "eb335cf8" ? green_tick : zNEW
				} else if (firstchar == "9") {
					// we have 3 hashes since we added stable items since they were added
					let good = [
						"6f0d97a9", // FF97+ dialog added
						"7cd5e14a", // FF65-97 marquee added
						"6fda9d97", // FF52-64 
					]
					notation = good.includes(hash) ? green_tick : zNEW
				}
			}
			dom[g].innerHTML = s6 + hash + sc + notation
		})
		dom.perf = Math.round(performance.now() - t0) +" ms"					

	} catch (e) {
		dom.details = e+""
	}
}

Promise.all([
	get_globals()
]).then(function(){
	run()
})

</script>
</body>
</html>
