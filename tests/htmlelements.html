<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=800">
	<title>HTML*ELement</title>
	<link rel="stylesheet" type="text/css" href="testindex.css">
	<script src="testglobals.js"></script>
	<script src="testgeneric.js"></script>
	<style>
		table {width: 90%; min-width: 600px; max-width: 780px}
		hr {color: var(--test15);}
		span.indent {
			display:inline-block;margin-left:10px;
		}
		.grey {color: grey;}
	</style>
</head>

<body>
	<table>
	<tr><td><h2>TorZillaPrint</h2></td></tr>
	<tr><td class="blurb"><a class="return" href="../index.html">return to TZP index</a></td></tr>
	</table>

	<table id="tb15">
		<col width="1%"><col width="99%">
		<thead><tr><th colspan="2">
			<div class="nav-title">HTML*Element
			<div class="nav-up"><span class="c perf" id="perf"></span></div>
			</div>
		</th></tr></thead>
		<tr><td colspan="2" class="intro">
			<span class="no_color"></span>
				<span class="btn15 btnfirst" onClick="run()">[ run ]</span>
				<input type="checkbox" id="optSort"> <span class="no_color">sort</span>
			</span>
		</td></tr>
		<tr><td colspan="2"><hr></td></tr>
		<tr><td colspan="2"></td></tr>
		<tr><td></td><td class="mono spaces" id="details"></td></tr>
	</table>
	<br>

<script>
'use strict';

s6 = s6.trim()
s15 = s15.trim()
sb = sb.trim()

let oData = {}
let aEverything = []

let htmlList = [
	1,
	// changes since FF115 (at least on windows)
	// property added unless prefixed with a minus sign
	'Button',
		// ^ (122/nightly) popoverTargetElement, popoverTargetAction
	'Element',
		// ^ (117) oncancel
	'IFrame',
		// ^ (121) loading
	'Input',
		// ^ (116) dirName
	'Media',
		// ^ (116) setSinkId, sinkId
		// (122/nightly) showPopover, hidePopover, togglePopover, popover, onbeforetoggle, -ondragexit
		// (122/nightly) -ondragexit
	'Select',
		// ^ (122/nightly) showPicker
	'Template',
		// (122/nightly) shadowRootMode, shadowRootDelegatesFocus
	'TextArea',
		// ^ (116) dirName
	'Video',
	2,
	'Canvas','Form','Frame','Meta','Object','Source',
	3,
	'Body','Dialog','FrameSet','Image','Link','Meter','Output','Progress','Script','Style',
	4,
	'Anchor','Area','Embed','FieldSet','HR','Label','OList','Option','OptionsCollection',
	'Table','TableCell','TableCol','TableRow','TableSection','Track',
	5,
	'Audio','BR','Base','DList','Data','DataList','Div','Document',
	'FormControlsCollection','Head','Heading','Html','LI','Legend',
	'Map','Mod','OptGroup','Paragraph','Picture','Pre','Quote','Span',
	'TableCaption','Time','Title','UList','Unknown',
]

let ignoreList = ['Element','Document','FormControlsCollection','OptionsCollection']
for (let i=0; i < htmlList.length; i++) {
	let value = htmlList[i]
	if ("string" === typeof value) {
		let suffix = ignoreList.includes(value) ? "" : "Element"
		htmlList[i] = 'HTML' + value + suffix
	}
}

let groupInfo = {
	1: ["main", "1main", "hidden", "changes since FF115"],
	2: ["interesting", "2interesting", "hiddenk", "changes since FF98 or known extension f*kery"],
	3: ["stable98", "2stable98", "hiddenv", "AFAICT FF98+ at least on desktop"],
	4: ["stable52", "3stable52", "hiddenw", "AFAICT FF52+ at least on desktop"],
	5: ["super boring","4boring","hiddenx", "boring AF + stable FF70+ <sup>(once HTMLDocument settled down)</sup>"],
}

function run() {
	// e.g. https://developer.mozilla.org/en-US/docs/Web/API/HTMLAnchorElement

	oData = {}
	aEverything = []
	let t0 = performance.now()
	let optSort = dom.optSort.checked

	try {
		let display = [], toggle = "", group = "", groups = [], name = ""

		htmlList.forEach(function(k) {
			if ("number" == typeof k) {
				name = groupInfo[k][0]
				let byline = groupInfo[k][3]
				group = groupInfo[k][1]
				toggle = groupInfo[k][2]
				groups.push(group)
				oData[group] = {}
				display.push(
					"<br><hr>"
					+ "<span id='label"+ toggle +"' class='btnfirst btn0' onClick=\"togglerows('"+ toggle +"','expand')\">[ expand ]</span> "
					+ "<span id='"+ group +"'></span> "
					+ name.toUpperCase() +" <span class='grey'>... "+ byline +"</span><br><br>"
				)
			} else {
				if (window[k] !== undefined) {
					let data = window[k].prototype
					try {
						let array = Object.getOwnPropertyNames(data)
						let fake = array.slice(array.indexOf("constructor")+1) // tampered: after constructor
						if (optSort) {array.sort()}
						let tmpArray = []
						array.forEach(function(item) {
							tmpArray.push(item)
							aEverything.push(item)
						})
						oData[group][k] = tmpArray
						let hash = mini(tmpArray), countFake = ""
						// count + color each fake individually
						if (fake.length) {
							countFake = " "+ sb + "("+ fake.length +")"+ sc
							fake.forEach(function(item) {
								array[array.indexOf(item)] = sb + item + sc
							})
						}
						display.push(
							s15 + k.padStart(30) + sc + ": "+ hash + s15 +" ("+ oData[group][k].length +")"+ sc + countFake +"<br>"+
							"<span class='tog" + toggle +" hidden grey'>[<br>" + "<span class='indent'>" + array.join(", ") +"</span>" + "<br>]</span>"
						)
					} catch(e) {
						console.log(k, "not an array", e+"")
					}					
				} else {
					console.log(k, "is undefined")
					// doesn't exist
				}
			}
		})

		// display
		let strAll = s15 +"ALL"+ sc +": "+ s6 + mini(oData) + sc
			+ " <span class='btn15 btnc' onclick='console.log(oData)'>[console]</span> "
			+ (optSort ? "sorted" : "unsorted")
		dom.details.innerHTML = strAll +"<br>"+ display.join("")

		// add sub hashes
		groups.forEach(function(g) {
			let hash = mini(oData[g])
			let notation = ""
			// notate
			if (isFF && !optSort) {
				if (g == "2stable98") {
					if (HTMLElement.prototype.hasOwnProperty("outerText")) { // FF98+
						notation = (hash == "bd1065f2") ? green_tick : zNEW
					}
				} else if (g == "3stable52") {
					notation = (hash == "d3ce4fc4") ? green_tick : zNEW
				} else if (g == "4boring") {
					// FF70+ HTMLDocument finally stabilized at constructor only
					let is70 = ("function" === typeof Intl.RelativeTimeFormat
							&& "function" === typeof Intl.RelativeTimeFormat.prototype.formatToParts)
					if (is70) {
						notation = hash == "078ef8c3" ? green_tick : zNEW
					}
				}
			}
			dom[g].innerHTML = s6 + hash + sc + notation
		})
		dom.perf = Math.round(performance.now() - t0) +" ms"					

		//* everything
		//console.log(aEverything) // 815 all : 749 (no constructors)
		aEverything.sort() // order is artifical due to htmlList so lets remove that here
		aEverything = aEverything.filter(function(item, position) {return aEverything.indexOf(item) === position}) // deduped
		let aPOC = aEverything.filter(x => !["constructor"].includes(x)) // remove constructor
		//console.log("'"+ aPOC.join("','") +"'") // 447
		//*/

		/* so what is in both or only in each
		// nightly 122
		let aTZP = ['ATTRIBUTE_NODE','CDATA_SECTION_NODE','COMMENT_NODE','DOCUMENT_FRAGMENT_NODE','DOCUMENT_NODE','DOCUMENT_POSITION_CONTAINED_BY','DOCUMENT_POSITION_CONTAINS','DOCUMENT_POSITION_DISCONNECTED','DOCUMENT_POSITION_FOLLOWING','DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC','DOCUMENT_POSITION_PRECEDING','DOCUMENT_TYPE_NODE','ELEMENT_NODE','ENTITY_NODE','ENTITY_REFERENCE_NODE','NOTATION_NODE','PROCESSING_INSTRUCTION_NODE','TEXT_NODE','accessKey','accessKeyLabel','addEventListener','after','align','animate','append','appendChild','ariaAtomic','ariaAutoComplete','ariaBusy','ariaChecked','ariaColCount','ariaColIndex','ariaColIndexText','ariaColSpan','ariaCurrent','ariaDescription','ariaDisabled','ariaExpanded','ariaHasPopup','ariaHidden','ariaInvalid','ariaKeyShortcuts','ariaLabel','ariaLevel','ariaLive','ariaModal','ariaMultiLine','ariaMultiSelectable','ariaOrientation','ariaPlaceholder','ariaPosInSet','ariaPressed','ariaReadOnly','ariaRelevant','ariaRequired','ariaRoleDescription','ariaRowCount','ariaRowIndex','ariaRowIndexText','ariaRowSpan','ariaSelected','ariaSetSize','ariaSort','ariaValueMax','ariaValueMin','ariaValueNow','ariaValueText','assignedSlot','attachInternals','attachShadow','attributes','autocapitalize','autofocus','baseURI','before','blur','checkVisibility','childElementCount','childNodes','children','classList','className','click','clientHeight','clientLeft','clientTop','clientWidth','cloneNode','closest','compareDocumentPosition','contains','contentEditable','convertPointFromNode','convertQuadFromNode','convertRectFromNode','dataset','dir','dispatchEvent','draggable','enterKeyHint','firstChild','firstElementChild','focus','getAnimations','getAttribute','getAttributeNS','getAttributeNames','getAttributeNode','getAttributeNodeNS','getBoundingClientRect','getBoxQuads','getClientRects','getElementsByClassName','getElementsByTagName','getElementsByTagNameNS','getRootNode','hasAttribute','hasAttributeNS','hasAttributes','hasChildNodes','hasPointerCapture','hidden','hidePopover','id','inert','innerHTML','innerText','inputMode','insertAdjacentElement','insertAdjacentHTML','insertAdjacentText','insertBefore','isConnected','isContentEditable','isDefaultNamespace','isEqualNode','isSameNode','lang','lastChild','lastElementChild','localName','lookupNamespaceURI','lookupPrefix','matches','mozMatchesSelector','mozRequestFullScreen','namespaceURI','nextElementSibling','nextSibling','nodeName','nodeType','nodeValue','nonce','normalize','offsetHeight','offsetLeft','offsetParent','offsetTop','offsetWidth','onabort','onanimationcancel','onanimationend','onanimationiteration','onanimationstart','onauxclick','onbeforeinput','onbeforetoggle','onblur','oncancel','oncanplay','oncanplaythrough','onchange','onclick','onclose','oncontextmenu','oncopy','oncuechange','oncut','ondblclick','ondrag','ondragend','ondragenter','ondragleave','ondragover','ondragstart','ondrop','ondurationchange','onemptied','onended','onerror','onfocus','onformdata','onfullscreenchange','onfullscreenerror','ongotpointercapture','oninput','oninvalid','onkeydown','onkeypress','onkeyup','onload','onloadeddata','onloadedmetadata','onloadstart','onlostpointercapture','onmousedown','onmouseenter','onmouseleave','onmousemove','onmouseout','onmouseover','onmouseup','onmozfullscreenchange','onmozfullscreenerror','onpaste','onpause','onplay','onplaying','onpointercancel','onpointerdown','onpointerenter','onpointerleave','onpointermove','onpointerout','onpointerover','onpointerup','onprogress','onratechange','onreset','onresize','onscroll','onscrollend','onsecuritypolicyviolation','onseeked','onseeking','onselect','onselectionchange','onselectstart','onslotchange','onstalled','onsubmit','onsuspend','ontimeupdate','ontoggle','ontransitioncancel','ontransitionend','ontransitionrun','ontransitionstart','onvolumechange','onwaiting','onwebkitanimationend','onwebkitanimationiteration','onwebkitanimationstart','onwebkittransitionend','onwheel','outerHTML','outerText','ownerDocument','parentElement','parentNode','part','popover','prefix','prepend','previousElementSibling','previousSibling','querySelector','querySelectorAll','releaseCapture','releasePointerCapture','remove','removeAttribute','removeAttributeNS','removeAttributeNode','removeChild','removeEventListener','replaceChild','replaceChildren','replaceWith','requestFullscreen','requestPointerLock','role','scroll','scrollBy','scrollHeight','scrollIntoView','scrollLeft','scrollLeftMax','scrollTo','scrollTop','scrollTopMax','scrollWidth','setAttribute','setAttributeNS','setAttributeNode','setAttributeNodeNS','setCapture','setHTMLUnsafe','setPointerCapture','shadowRoot','showPopover','slot','spellcheck','style','tabIndex','tagName','textContent','title','toggleAttribute','togglePopover','translate','webkitMatchesSelector']
		let onlyTZP = aTZP.filter(x => !aPOC.includes(x))
		let onlyPOC = aPOC.filter(x => !aTZP.includes(x))
		let aCommon = aPOC.filter(x => aTZP.includes(x))
		console.log("onlyTZP", onlyTZP.length+"\n", "['"+ onlyTZP.join("','") +"']" )
		console.log("onlyPOC", onlyPOC.length+"\n", "['"+ onlyPOC.join("','") +"']" )
		console.log("aCommon", aCommon.length+"\n", "['"+ aCommon.join("','") +"']" )
		//*/

	} catch (e) {
		dom.details = e+""
	}
}

Promise.all([
	get_globals()
]).then(function(){
	run()
})

</script>
</body>
</html>
